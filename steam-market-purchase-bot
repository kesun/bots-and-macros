// MODIFY THIS AREA ONLY
var desiredPrice = 0.05;
var desiredPurchaseCount = 1;
// END OF MODIFICATION AREA

var purchased = 0;

var windowID = window.open(document.URL, "_blank", "width=500, height=300");

checkReady();

function refresh(){
	console.log("refresh");
	windowID.location.reload();
	isRefreshing = true;
	setTimeout(checkReady, 500);
}

function checkReady(){
	console.log("checkReady");
	var priceListLen = windowID.document.getElementsByClassName('market_listing_their_price').length;
	if(windowID.document.getElementsByTagName('zzzzz').length == 0 && priceListLen > 1){
		checkPrice();
	}else{
		setTimeout(checkReady, 100);
	}
}

function checkPrice(){
	console.log("checkPrice");
    windowID.document.getElementsByTagName("html")[0].appendChild(windowID.document.createElement("zzzzz"));
	var curPrice = parseFloat(windowID.document.getElementsByClassName('market_listing_their_price')[1].getElementsByClassName("market_listing_price_with_fee")[0].innerHTML.replace(/\s/g, '').substr(4));
	console.log("curPrice: " + curPrice);
	if(curPrice <= desiredPrice){
		windowID.document.getElementsByClassName('item_market_action_button_contents')[0].click();
		windowID.document.getElementById('market_buynow_dialog_accept_ssa').click();
		windowID.document.getElementById('market_buynow_dialog_purchase').getElementsByTagName("span")[0].click();
		checkTransactionState();
	}else{
		refresh();
	}
}

function checkTransactionState(){
  // TODO
}
